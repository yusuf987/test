<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>demo</title>
    <!-------api---------->
    <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css">


    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">

    <!-------api---------->

    <script
        src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://openlayers.org/en/v3.20.1/build/ol.js"></script>

    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="style4.css">

    <!-- Font Awesome JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--  <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
 -->

    <style type="text/css">
        .ol-attribution {
            display: none !important;
        }

        .map {
            height: 480px;
            overflow: scroll;
        }

        /*.ol-overlaycontainer{
width: 100px !important;
height: 300px !important;
  }*/

        @media screen and (min-width: 200px) {
            /* .ol-overlaycontainer{
width: 100px !important;
height: 300px !important;
  }*/
        }
    </style>
</head>

<body>

    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>J.L.S</h3>
                <strong>JLS</strong>
            </div>

            <ul class="list-unstyled components">
                <li>
                    <a id="lock">
                        <i class="fa fa-lock-grab-o"></i>

                        lock screen
                    </a>

                    <a id="unlock">
                        <i class="fa fa-lock-grab-o"></i>

                        unlock screen
                    </a>
                    
                    <a href="#" id="none-click">
                        <i class="fa fa-hand-grab-o"></i>

                        Pointer
                    </a>
                    <a href="#" id="upload-img" onclick="document.getElementById('fileInput').click();">
                        <input id="fileInput" type="file" style="display:none;" />
                        <i class="fa fa-upload"></i> Upload Image
                    </a>
                    <a href="#" id="rotate-right">
                        <i class="fa fa-undo"></i>
                        Rotate Left
                    </a>
                    <a href="#" id="rotate-left">
                        <i class="fa fa-repeat" aria-hidden="true"></i>
                        Rotate Right
                    </a>
                    <a href="#" id="square-click">
                        <i class="fa fa-square"></i>
                        Square
                    </a>
                    <a href="#" id="rectangle-click">
                        <i class="fa fa-square-o" aria-hidden="true"></i>
                        Rectangle
                    </a>
                    <a href="#" id="star-click">
                        <i class="fa fa-star" aria-hidden="true"></i>
                        Star
                    </a>
                    <a href="#" id="line-click"> |
                        Line
                    </a>
                    <a href="#" id="polygon-click">
                        <i class="fa fa-square-o" aria-hidden="true"></i>
                        Polygon
                    </a>
                    <a href="#" id="circle-click">
                        <i class="fa fa-circle"></i>
                        Circle
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Page Content  -->
        <div id="content">

            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <!--                         <i class="fas fa-align-left"></i>
 --> <i class="fa fa-bars" aria-hidden="true"></i>

                        <!-- <span>Toggle Sidebar</span> -->
                    </button>
                    <button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <i class="fas fa-align-justify"></i>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="nav-item active">
                                <a class="nav-link" href="#">
                                    Save</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Cancel</a>
                            </li>

                        </ul>
                    </div>
                </div>
            </nav>

            <div>
                <div id="map" class="map" style="border:1px solid"></div>
                <!--      <button id="rotate-left" title="Rotate clockwise">↻</button>
    <button id="rotate-right" title="Rotate counterclockwise">↺</button> -->
                <!--  <button id="pan-to-london">Pan to London</button> -->
                <!-- <button id="elastic-to-moscow">Elastic to Moscow</button>
    <button id="bounce-to-istanbul">Bounce to Istanbul</button>
    <button id="spin-to-rome">Spin to Rome</button>
    <button id="fly-to-bern">Fly to Bern</button>
    <button id="rotate-around-rome">Rotate around Rome</button>
    <button id="tour">Take a tour</button> -->

                <form class="form-inline" style="display: none">
                    <label>Shape type &nbsp;</label>
                    <select id="type">
                        <option value="Square">Square</option>
                        <option value="Box">Box</option>
                        <option value="Star">Star</option>
                        <option value="Point">Point</option>
                        <option value="LineString">LineString</option>
                        <option value="Polygon">Polygon</option>
                        <option value="Circle">Circle</option>
                        <option value="None">None</option>
                    </select>
                </form>
                <!--   <input class="form-control mr-2 mb-2 mt-2" type="button" value="Undo" id="undo"> -->

            </div>

            <!-- jQuery CDN - Slim version (=without AJAX) -->
            <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous"></script>
            <!-- Popper.JS -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
                integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
                crossorigin="anonymous"></script>
            <!-- Bootstrap JS -->
            <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
                integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
                crossorigin="anonymous"></script>

            <script type="text/javascript">
                $(document).ready(function () {
                    $('#sidebarCollapse').on('click', function () {
                        $('#sidebar').toggleClass('active');
                    });
                });
            </script>


            <script>


                var zzz
                var count = 0;
                init('https://imgs.xkcd.com/comics/online_communities.png');

                document.querySelector('input[type="file"]').addEventListener('change', function () {
                    if (this.files && this.files[0]) {
                        let urlPath = URL.createObjectURL(this.files[0]);
                        console.log(" url path ", urlPath);
                        count++;
                        removeDivs();
                        init(urlPath);
                    }
                });


                function removeDivs() {
                    $("div.ol-viewport").remove();
                }








                // function preview_image(event) {
                //     var reader = new FileReader();
                //     console.log(reader.result)
                //     // reader.onload = function(){
                //     //   var output = document.getElementById('output_image');
                //     //   output.src = reader.result;
                //     // }
                //     reader.readAsDataURL(event.target.files[0]);
                //   }


                function init(imgurl) {

                    console.log("img url : ", imgurl)
                    let ImgPath = imgurl;

                    let extent = [0, 0, 1024, 968];
                    let projection = new ol.proj.Projection({
                        code: 'xkcd-image',
                        units: 'pixels',
                        extent: extent
                    });
                    let raster = new ol.layer.Tile({
                        source: new ol.source.OSM()
                    });
                    let source = new ol.source.Vector({ wrapX: false });
                    // let vector = new ol.layer.Vector({
                    //   source: source
                    // });

                    var vector = new ol.layer.Vector({
                        source: source,
                        style: new ol.style.Style({
                            fill: new ol.style.Fill({
                                color: 'rgba(255, 255, 255, 0.2)'
                            }),
                            stroke: new ol.style.Stroke({
                                color: '#ffcc33',
                                width: 2
                            }),
                            image: new ol.style.Circle({
                                radius: 7,
                                fill: new ol.style.Fill({
                                    color: '#ffcc33'
                                })
                            })
                        })
                    });


                    let typeSelect = document.getElementById('type');

                    let draw; // global so we can remove it later
                    function addInteraction() {
                        var value = typeSelect.value;
                        if (value !== 'None') {
                            var geometryFunction;
                            if (value === 'Square') {
                                value = 'Circle';
                                geometryFunction = ol.interaction.Draw.createRegularPolygon(4);
                            } else if (value === 'Box') {
                                value = 'Circle';
                                geometryFunction = ol.interaction.Draw.createBox();
                            } else if (value === 'Star') {
                                value = 'Circle';
                                geometryFunction = function (coordinates, geometry) {
                                    if (!geometry) {
                                        geometry = new ol.geom.Polygon(null);
                                    }
                                    var center = coordinates[0];
                                    var last = coordinates[1];
                                    var dx = center[0] - last[0];
                                    var dy = center[1] - last[1];
                                    var radius = Math.sqrt(dx * dx + dy * dy);
                                    var rotation = Math.atan2(dy, dx);
                                    var newCoordinates = [];
                                    var numPoints = 12;
                                    for (var i = 0; i < numPoints; ++i) {
                                        var angle = rotation + i * 2 * Math.PI / numPoints;
                                        var fraction = i % 2 === 0 ? 1 : 0.5;
                                        var offsetX = radius * fraction * Math.cos(angle);
                                        var offsetY = radius * fraction * Math.sin(angle);
                                        newCoordinates.push([center[0] + offsetX, center[1] + offsetY]);
                                    }
                                    newCoordinates.push(newCoordinates[0].slice());
                                    geometry.setCoordinates([newCoordinates]);
                                    return geometry;
                                };
                            }
                            draw = new ol.interaction.Draw({
                                source: source,
                                type: /** @type {ol.geom.GeometryType} */ (value),
                                geometryFunction: geometryFunction
                            });
                            map.addInteraction(draw);
                        }
                    }


                    /***************  view rotate  **********************/

                    let view = new ol.View({
                        projection: projection,
                        center: ol.extent.getCenter(extent),
                        zoom: 1,
                        maxZoom: 5,
                    });


                    let imgLayer = new ol.layer.Image({
                        source: new ol.source.ImageStatic({
                            attributions: '© <a href="http://xkcd.com/license.html">xkcd</a>',
                            url: ImgPath,
                            projection: projection,
                            imageExtent: extent,
                        })
                    })


                    imgLayer.set('name', 'priya'.concat(count));

                    var lock = true


                    let map = new ol.Map({
                        layers: [imgLayer
                            , vector],
                        target: 'map',
                        interactions: ol.interaction.defaults({
                            dragPan: lock
                        }),
                        loadTilesWhileAnimating: true,
                        view: view
                    });

                    $(document).on('click', '#lock', null, function () {
                        lock = !lock
                        
                        var dragPan;
                        map.getInteractions().forEach(function (interaction) {
                            if (interaction instanceof ol.interaction.DragPan) {
                                console.log(interaction)

                                dragPan = interaction;
                            }
                        }, this);
                        zzz = dragPan
                        map.removeInteraction(dragPan);

                      //  map.addInteraction(hoverMap);
                    })


                    $(document).on('click', '#unlock', null, function () {
                      
                        if(zzz)
                        map.addInteraction(zzz);

                       
                      //  map.addInteraction(hoverMap);
                    })

                    if (count > 0) {
                        map.getLayers().forEach(layer => {
                            console.log(layer, " : ", layer.get('name'))
                            if (layer && layer.get('name') === 'priya'.concat(count - 1)) {
                                console.log("here : ", layer)
                                map.removeLayer(layer)
                            }

                        });
                    }

                    function onClick(id, callback) {
                        document.getElementById(id).addEventListener('click', callback);
                    }

                    onClick('rotate-left', function () {
                        console.log("view ", view)
                        view.animate({
                            rotation: view.getRotation() + Math.PI / 2
                        });
                    });

                    onClick('rotate-right', function () {
                        view.animate({
                            rotation: view.getRotation() - Math.PI / 2
                        });
                    });

                    onClick('rectangle-click', function () {
                        typeSelect.value = "Box"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('square-click', function () {
                        typeSelect.value = "Square"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('star-click', function () {
                        typeSelect.value = "Star"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('line-click', function () {
                        typeSelect.value = "LineString"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('polygon-click', function () {
                        typeSelect.value = "Polygon"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('circle-click', function () {
                        typeSelect.value = "Circle"
                        map.removeInteraction(draw);
                        addInteraction();
                    });

                    onClick('none-click', function () {
                        typeSelect.value = "None"
                        map.removeInteraction(draw);
                        addInteraction();
                    });






                    typeSelect.onchange = function () {
                        map.removeInteraction(draw);
                        addInteraction();
                    };
                    addInteraction();
                }

      // document.getElementById('undo').addEventListener('click', function () {
      //    draw.removeLastPoint();
      // });

            </script>


</body>

</html>